<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/engine/debug.js - Panda.js</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/vendor/yui-min.js"></script>
</head>
<body>

<div id="doc">
    <header class="main-header">
        <div class="content">
            <div class="project-title">
                
                    <img class="logo" src="../../img/logo.png" title="Panda.js">
                
                
                    <h1 class="project-name">Panda.js</h1> <span class="project-version">1.1.3</span>
                
                
                    <p class="description">HTML5 game engine</p>
                
            </div>
            <ul class="jump-links">
                <li><a href="#index" class="index-jump-link">index</a></li>
                <li><a href="#top" class="top-jump-link">top</a></li>
            </ul>
        </div>
    </header>
    <div id="bd" class="main-body">

        <div id="docs-sidebar" class="sidebar apidocs">
            <div id="api-list">
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a class="type" href="../classes/game.Analytics.html">game.Analytics</a></li>
            
                <li><a class="type" href="../classes/game.Audio.html">game.Audio</a></li>
            
                <li><a class="type" href="../classes/game.Body.html">game.Body</a></li>
            
                <li><a class="type" href="../classes/game.Circle.html">game.Circle</a></li>
            
                <li><a class="type" href="../classes/game.Class.html">game.Class</a></li>
            
                <li><a class="type" href="../classes/game.CollisionSolver.html">game.CollisionSolver</a></li>
            
                <li><a class="type" href="../classes/game.Container.html">game.Container</a></li>
            
                <li><a class="type" href="../classes/game.Core.html">game.Core</a></li>
            
                <li><a class="type" href="../classes/game.Debug.html">game.Debug</a></li>
            
                <li><a class="type" href="../classes/game.DebugDraw.html">game.DebugDraw</a></li>
            
                <li><a class="type" href="../classes/game.Emitter.html">game.Emitter</a></li>
            
                <li><a class="type" href="../classes/game.Keyboard.html">game.Keyboard</a></li>
            
                <li><a class="type" href="../classes/game.Line.html">game.Line</a></li>
            
                <li><a class="type" href="../classes/game.Loader.html">game.Loader</a></li>
            
                <li><a class="type" href="../classes/game.Particle.html">game.Particle</a></li>
            
                <li><a class="type" href="../classes/game.Pool.html">game.Pool</a></li>
            
                <li><a class="type" href="../classes/game.Rectangle.html">game.Rectangle</a></li>
            
                <li><a class="type" href="../classes/game.Scene.html">game.Scene</a></li>
            
                <li><a class="type" href="../classes/game.Sprite.html">game.Sprite</a></li>
            
                <li><a class="type" href="../classes/game.Storage.html">game.Storage</a></li>
            
                <li><a class="type" href="../classes/game.System.html">game.System</a></li>
            
                <li><a class="type" href="../classes/game.Timer.html">game.Timer</a></li>
            
                <li><a class="type" href="../classes/game.Tween.html">game.Tween</a></li>
            
                <li><a class="type" href="../classes/game.TweenEngine.html">game.TweenEngine</a></li>
            
                <li><a class="type" href="../classes/game.TweenGroup.html">game.TweenGroup</a></li>
            
                <li><a class="type" href="../classes/game.Vector.html">game.Vector</a></li>
            
                <li><a class="type" href="../classes/game.World.html">game.World</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a class="module" href="../modules/analytics.html">analytics</a></li>
            
                <li><a class="module" href="../modules/audio.html">audio</a></li>
            
                <li><a class="module" href="../modules/core.html">core</a></li>
            
                <li><a class="module" href="../modules/debug.html">debug</a></li>
            
                <li><a class="module" href="../modules/keyboard.html">keyboard</a></li>
            
                <li><a class="module" href="../modules/loader.html">loader</a></li>
            
                <li><a class="module" href="../modules/particle.html">particle</a></li>
            
                <li><a class="module" href="../modules/physics.html">physics</a></li>
            
                <li><a class="module" href="../modules/pool.html">pool</a></li>
            
                <li><a class="module" href="../modules/scene.html">scene</a></li>
            
                <li><a class="module" href="../modules/sprite.html">sprite</a></li>
            
                <li><a class="module" href="../modules/storage.html">storage</a></li>
            
                <li><a class="module" href="../modules/system.html">system</a></li>
            
                <li><a class="module" href="../modules/timer.html">timer</a></li>
            
                <li><a class="module" href="../modules/tween.html">tween</a></li>
            
            </ul>
        </div>
    </div>
</div>

        </div>

        <div id="docs-main" class="apidocs">
            <div class="content container">
                <h1 class="file-heading">File: src/engine/debug.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
    Debugging.
    
    @module debug
    @namespace game
**/
game.module(
    &#x27;engine.debug&#x27;
)
.body(function() { &#x27;use strict&#x27;;

/**
    DebugDraw will draw all interactive sprite hit areas and physic shapes.
    Automatically enabled, if URL contains &#x60;?debugdraw&#x60;.
    @class DebugDraw
**/
game.DebugDraw = game.Class.extend({
    /**
        @property {game.Container} container
    **/
    container: null,

    init: function() {
        this.container = new game.Container();
    },

    /**
        Remove all sprites from DebugDraw.
        @method reset
    **/
    reset: function() {
        for (var i = this.container.children.length - 1; i &gt;= 0; i--) {
            this.container.removeChild(this.container.children[i]);
        }
        game.system.stage.addChild(this.container);
    },

    /**
        Add sprite to DebugDraw.
        @method addSprite
        @param {game.Sprite} sprite
    **/
    addSprite: function(sprite) {
        var grap = new game.Graphics();
        grap.beginFill(game.DebugDraw.spriteColor);

        if(sprite.hitArea) grap.drawRect(sprite.hitArea.x, sprite.hitArea.y, sprite.hitArea.width, sprite.hitArea.height);
        else grap.drawRect(-sprite.width * sprite.anchor.x, -sprite.height * sprite.anchor.y, sprite.width, sprite.height);

        grap.target = sprite;
        grap.alpha = game.DebugDraw.spriteAlpha;
        this.container.addChild(grap);
    },

    /**
        Add body to DebugDraw.
        @method addBody
        @param {game.Body} body
    **/
    addBody: function(body) {
        var sprite = new game.Graphics();
        this.drawDebugSprite(sprite, body);

        sprite.position.x = body.position.x;
        sprite.position.y = body.position.y;
        sprite.target = body;
        sprite.alpha = game.DebugDraw.shapeAlpha;
        this.container.addChild(sprite);
    },

    drawDebugSprite: function(sprite, body) {
        sprite.clear();
        sprite.beginFill(game.DebugDraw.shapeColor);

        if(body.shape instanceof game.Rectangle) {
            sprite.drawRect(-body.shape.width/2, -body.shape.height/2, body.shape.width, body.shape.height);
            sprite.width = body.shape.width;
            sprite.height = body.shape.height;
        }
        if(body.shape instanceof game.Circle) {
            sprite.drawCircle(0, 0, body.shape.radius);
            sprite.radius = body.shape.radius;
        }
        // TODO add support for game.Line
    },

    /**
        Update DebugDraw sprites.
        @method update
    **/
    update: function() {
        for (var i = this.container.children.length - 1; i &gt;= 0; i--) {
            this.container.children[i].rotation = this.container.children[i].target.rotation;

            if(game.modules[&#x27;engine.physics&#x27;] &amp;&amp; this.container.children[i].target instanceof game.Body) {
                if(this.container.children[i].width !== this.container.children[i].target.shape.width ||
                    this.container.children[i].height !== this.container.children[i].target.shape.height) {
                    this.drawDebugSprite(this.container.children[i], this.container.children[i].target);
                }
                if(this.container.children[i].radius !== this.container.children[i].target.shape.radius) {
                    this.drawDebugSprite(this.container.children[i], this.container.children[i].target);
                }

                this.container.children[i].position.x = this.container.children[i].target.position.x + game.scene.stage.position.x;
                this.container.children[i].position.y = this.container.children[i].target.position.y + game.scene.stage.position.y;
                if(!this.container.children[i].target.world) {
                    this.container.removeChild(this.container.children[i]);
                }
            } else {
                if(this.container.children[i].target.parent) this.container.children[i].target.updateTransform();
                this.container.children[i].position.x = this.container.children[i].target.worldTransform.tx;
                this.container.children[i].position.y = this.container.children[i].target.worldTransform.ty;
                this.container.children[i].scale.x = this.container.children[i].target.scale.x;
                this.container.children[i].scale.y = this.container.children[i].target.scale.y;
                if(!this.container.children[i].target.parent) {
                    this.container.removeChild(this.container.children[i]);
                }
            }
        }
    }
});

/**
    Color of DebugDraw sprites.
    @attribute {Number} spriteColor
    @default 0xff0000
**/
game.DebugDraw.spriteColor = 0xff0000;
/**
    Alpha of DebugDraw sprites.
    @attribute {Number} spriteAlpha
    @default 0.3
**/
game.DebugDraw.spriteAlpha = 0.3;
/**
    Color of DebugDraw shapes.
    @attribute {Number} shapeColor
    @default 0x0000ff
**/
game.DebugDraw.shapeColor = 0x0000ff;
/**
    Alpha of DebugDraw shapes.
    @attribute {Number} shapeAlpha
    @default 0.3
**/
game.DebugDraw.shapeAlpha = 0.3;
/**
    Enable DebugDraw.
    @attribute {Boolean} enabled
**/
game.DebugDraw.enabled = document.location.href.match(/\?debugdraw/) ? true : false;

/**
    @class Debug
    @extends game.Class
**/
game.Debug = game.Class.extend({
    frames: 0,
    last: 0,
    fps: 0,
    fpsText: null,
    /**
        Fps update frequency in milliseconds.
        @property {Number|pandaConfig.fpsFrequency} frequency
        @default 1000
    **/
    frequency: game.config.fpsFrequency || 1000,
    /**
        Fps text color.
        @property {String|pandaConfig.fpsColor} color
        @default &#x27;black&#x27;
    **/
    color: game.config.fpsColor || &#x27;black&#x27;,
    position: {
        x: 10,
        y: 10
    },

    init: function() {
        this.fpsText = new game.Text(&#x27;0&#x27;, {fill: this.color});
        this.fpsText.position.set(this.position.x, this.position.y);
        game.system.stage.addChild(this.fpsText);
    },

    update: function() {
        this.frames++;

        if(game.Timer.last &gt;= this.last + this.frequency) {
            this.fps = (Math.round((this.frames * 1000) / (game.Timer.last - this.last))).toString();
            if(this.fps !== this.fpsText.text) this.fpsText.setText(this.fps.toString());
            this.last = game.Timer.last;
            this.frames = 0;
        }
    }
});

/**
    Enable fps display.
    @attribute {Boolean|pandaConfig.debug} enabled
    @default false
**/
game.Debug.enabled = document.location.href.toLowerCase().match(/\?debug/) || pandaConfig.debug;

});
    </pre>
</div>

            </div>
        </div>

    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/vendor/jquery.min.js"></script>
<script src="../assets/js/jquery-offscreen-trigger.js"></script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
